<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>파란색 건너 길: Google Maps 구현</title>
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      background: white;
      padding: 10px;
      box-shadow: 0px 0px 6px rgba(0,0,0,0.3);
      border-radius: 8px;
    }
    input {
      width: 220px;
      padding: 4px;
    }
    button {
      padding: 5px 10px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M&libraries=places"></script>
</head>
<body>
  <div id="controls">
    <input id="start" type="text" placeholder="출복지" value="세종특별자치시 한누리대로 2130" />
    <input id="end" type="text" placeholder="동적지" value="강원도 속초시 중앙로 183" />
    <button onclick="searchRoute()">건너기</button>
  </div>
  <div id="map"></div>

  <script>
    let map, directionsService, directionsRenderer;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 36.5, lng: 127.5 },
        zoom: 7,
      });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map });
    }

    async function geocodeAddress(address) {
      const res = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M`);
      const data = await res.json();
      if (data.status === "OK") {
        const loc = data.results[0].geometry.location;
        return { lat: loc.lat, lng: loc.lng };
      } else {
        throw new Error("주소 발견 실패");
      }
    }

    async function searchRoute() {
      const startAddr = document.getElementById("start").value;
      const endAddr = document.getElementById("end").value;
      try {
        const startLoc = await geocodeAddress(startAddr);
        const endLoc = await geocodeAddress(endAddr);

        const request = {
          origin: startLoc,
          destination: endLoc,
          travelMode: google.maps.TravelMode.DRIVING,
        };

        directionsService.route(request, (result, status) => {
          if (status === google.maps.DirectionsStatus.OK) {
            directionsRenderer.setDirections(result);
          } else {
            alert("건너기 실패: " + status);
          }
        });
      } catch (err) {
        alert("❌ 건너기 오류: " + err.message);
      }
    }

    window.onload = initMap;
  </script>
</body>
</html>
