<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>해안 경로 추천</title>
    <style>
        body { font-family: sans-serif; margin: 0; }
        #controls { padding: 10px; background: #f8f9fa; }
        #map { width: 100%; height: 90vh; }
        input { width: 250px; padding: 6px; margin-right: 8px; }
        button { padding: 6px 12px; }
    </style>
</head>
<body>
    <div id="controls">
        <input id="start" placeholder="출발지 주소" />
        <input id="end" placeholder="도착지 주소" />
        <button onclick="fetchRoute()">경로 검색</button>
    </div>
    <div id="map"></div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M&libraries=places&loading=async" async defer></script>
    <script>
        let map, routeLine;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 36.3, lng: 127.4 },
                zoom: 8
            });
        }

        async function fetchRoute() {
            const start = document.getElementById("start").value;
            const end = document.getElementById("end").value;

            const res = await fetch("/route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start, end })
            });

            const data = await res.json();
            if (!res.ok || !data.path) {
                alert("❌ 경로 생성 실패: " + (data.error || "서버 오류"));
                return;
            }

            const coords = data.path.map(p => ({ lat: p[1], lng: p[0] }));
            if (routeLine) routeLine.setMap(null);
            routeLine = new google.maps.Polyline({
                path: coords,
                strokeColor: "#007bff",
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            routeLine.setMap(map);
            map.setCenter(coords[0]);
        }

        window.onload = initMap;
    </script>
</body>
</html>
