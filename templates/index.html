<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>해안도로 경로 추천</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M&libraries=places"></script>
    <style>
        #map {
            height: 90vh;
            width: 100%;
        }
        #controls {
            padding: 10px;
        }
        input {
            width: 40%;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <input id="start" placeholder="출발지 주소" />
        <input id="end" placeholder="도착지 주소" />
        <button onclick="fetchRoute()">🚗 경로 검색</button>
    </div>
    <div id="map"></div>

    <script>
        let map, directionsRenderer, polyline;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 36.5, lng: 127.9 },
                zoom: 7,
            });
        }

        async function fetchRoute() {
            const start = document.getElementById("start").value;
            const end = document.getElementById("end").value;

            const res = await fetch("/route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start, end })
            });

            if (!res.ok) {
                console.error("❌ 서버 응답 오류", res.status);
                alert("서버 오류 또는 네트워크 오류가 발생했습니다.");
                return;
            }

            const data = await res.json();
            if (!data.route) {
                console.error("❌ fetchRoute 실패:", data.error);
                alert(data.error || "경로 요청 실패");
                return;
            }

            const coords = data.route.traoptimal[0].path.map(([lng, lat]) => ({ lat, lng }));

            if (polyline) polyline.setMap(null);

            polyline = new google.maps.Polyline({
                path: coords,
                geodesic: true,
                strokeColor: "#007bff",
                strokeOpacity: 0.8,
                strokeWeight: 5
            });

            polyline.setMap(map);
            map.setCenter(coords[0]);
        }

        window.onload = initMap;
    </script>
</body>
</html>
