<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>해안 경로 추천</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; }
        #controls { padding: 10px; background: #f0f0f0; }
        #map { width: 100%; height: 90vh; }
        input { width: 300px; margin-right: 10px; }
        button { padding: 5px 10px; }
    </style>
</head>
<body>
    <div id="controls">
        <input type="text" id="start" placeholder="출발지 주소 입력">
        <input type="text" id="end" placeholder="도착지 주소 입력">
        <button onclick="fetchRoute()">경로 검색</button>
    </div>
    <div id="map"></div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M&libraries=places&loading=async" async defer></script>
    <script>
        let map, routeLine;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 7,
                center: { lat: 36.5, lng: 127.5 }
            });
        }

        async function fetchRoute() {
            const start = document.getElementById("start").value;
            const end = document.getElementById("end").value;

            const res = await fetch("/route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start, end })
            });

            let data;
            try {
                data = await res.json();
            } catch (e) {
                alert("❌ 서버 응답 오류 (JSON 변환 실패)");
                return;
            }

            if (!res.ok || !data.route || !data.route.traoptimal || !data.route.traoptimal[0].path) {
                alert("❌ 경로 없음 또는 오류: " + (data.error || "서버 오류"));
                console.error(data);
                return;
            }

            const path = data.route.traoptimal[0].path;
            const coords = path.map(p => ({ lat: p[1], lng: p[0] }));

            if (routeLine) routeLine.setMap(null);
            routeLine = new google.maps.Polyline({
                path: coords,
                geodesic: true,
                strokeColor: "#007bff",
                strokeOpacity: 1.0,
                strokeWeight: 4
            });

            routeLine.setMap(map);
            map.setCenter(coords[0]);
        }

        window.onload = initMap;
    </script>
</body>
</html>
