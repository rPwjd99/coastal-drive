<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>í•´ì•ˆë„ë¡œ ê²½ë¡œ ì¶”ì²œ</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9MSD-WhkqK_Og5YdVYfux21xiRjy2q1M&libraries=places"></script>
    <style>
        #map {
            height: 90vh;
            width: 100%;
        }
        #controls {
            padding: 10px;
        }
        input {
            width: 40%;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div id="controls">
        <input id="start" placeholder="ì¶œë°œì§€ ì£¼ì†Œ" />
        <input id="end" placeholder="ë„ì°©ì§€ ì£¼ì†Œ" />
        <button onclick="fetchRoute()">ğŸš— ê²½ë¡œ ê²€ìƒ‰</button>
    </div>
    <div id="map"></div>

    <script>
        let map, directionsRenderer, polyline;

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 36.5, lng: 127.9 },
                zoom: 7,
            });
        }

        async function fetchRoute() {
            const start = document.getElementById("start").value;
            const end = document.getElementById("end").value;

            const res = await fetch("/route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start, end })
            });

            if (!res.ok) {
                console.error("âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜", res.status);
                alert("ì„œë²„ ì˜¤ë¥˜ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                return;
            }

            const data = await res.json();
            if (!data.route) {
                console.error("âŒ fetchRoute ì‹¤íŒ¨:", data.error);
                alert(data.error || "ê²½ë¡œ ìš”ì²­ ì‹¤íŒ¨");
                return;
            }

            const coords = data.route.traoptimal[0].path.map(([lng, lat]) => ({ lat, lng }));

            if (polyline) polyline.setMap(null);

            polyline = new google.maps.Polyline({
                path: coords,
                geodesic: true,
                strokeColor: "#007bff",
                strokeOpacity: 0.8,
                strokeWeight: 5
            });

            polyline.setMap(map);
            map.setCenter(coords[0]);
        }

        window.onload = initMap;
    </script>
</body>
</html>
